## Change Log

`21.11.2025` — Небольшие доработки. Перенос проекта в Docker. Актуализация документации.

`12.05.2025` — Удален нерелевантный код. Исправлены названия ячеек (после обновления названий в таблице).

`25.01.2024` — Удалена интеграция с сервисом Heroku.

`17.10.2023` — Канал @ChatWarsAuction перестал быть доступен для парсинга. Переход на Telethon. Скрипт `main.py` стал основным, `oldest.py` сохранен для истории.

`28.11.2022` — Функция e-objects 1.2.0 перенесена в `functions.py`. Добавлена функция `start()` для серверного запуска.


## Архиватор Telegram-каналов (CW-Notify-Storage-Oldest)

Автономный сервис для долгосрочной архивации истории сообщений из игровых Telegram-каналов в Google Таблицы.

### Принципы работы и архитектура

1. **Сбор данных через MTProto**:
   В основе лежит библиотека **Telethon**, обеспечивающая прямое взаимодействие с API Telegram. Это позволяет эффективно выгружать исторические сообщения (deep history parsing), обходя ограничения стандартных ботов.

2. **Динамическая конфигурация**:
   Система поддерживает мультисерверную архитектуру. Списки целевых каналов и идентификаторы таблиц-хранилищ загружаются динамически из центральной Google-таблицы (`Notify/resources`). Добавление нового источника данных не требует изменения кода.

3. **Каскадная система хранения**:
   Для обхода технических ограничений Google Sheets API (лимиты на количество ячеек, таймауты при работе с большими документами) реализован механизм ротации:
   - Данные первично накапливаются во **временной таблице** (буфере).
   - При достижении лимита в **50 000 записей** создается новый лист в основном архиве, куда переносится накопленный массив.
   - Временная таблица пересоздается для следующего цикла.
   Это гарантирует стабильность работы при объемах данных, превышающих сотни тысяч сообщений.

4. **Обработка и нормализация**:
   - Сообщения преобразуются в линейный формат: `ID сообщения` / `Текст`.
   - Производится санитарная обработка HTML-тегов и спецсимволов (экранирование слешей, замена переносов строк) для сохранения целостности структуры данных.
   - Использование `gspread` в связке с нативными batch-запросами Google API обеспечивает высокую скорость записи и корректное форматирование ячеек.
